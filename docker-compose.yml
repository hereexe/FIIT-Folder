version: '3.8'

services:
  # 1. Backend API (C#)
  api:
    build:
      context: ./backend
      dockerfile: ./Dockerfile
    container_name: fiit_api
    restart: always
    ports:
      - "8080:8080"  # API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://IP:8080
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:8080
      # –í–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏ Docker –º—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –±–∞–∑–µ –ø–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞ 'mongo'
      MONGODB_CONNECTION_STRING: "mongodb://root:password@mongo:27017/?authSource=admin"
      MONGODB_DATABASE_NAME: "FIITFolder"
    depends_on:
      mongo:
        condition: service_healthy
    networks:
      - fiit-network

  # 2. Frontend (React + Nginx)
  frontend:
    build:
      context: ./frontend/react_ts
      dockerfile: ./Dockerfile
    container_name: fiit_frontend
    restart: always
    ports:
      # –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 80 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç WEB) -> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 80 (Nginx)
      - "80:80"
    environment:
      # üõë –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏ YOUR_SERVER_IP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π IP, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—Å—Ç –Ø–Ω–¥–µ–∫—Å
      # –ü—Ä–∏–º–µ—Ä: http://158.160.XX.XX:8080
      REACT_APP_API_URL: "http://158.160.99.237:8080"
    depends_on:
      - api
    networks:
      - fiit-network

  # 3. MongoDB Database
  mongo:
    image: mongo:6.0
    container_name: fiit_mongo
    restart: always
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
      - mongo-config:/data/configdb
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: password
      MONGO_INITDB_DATABASE: FIITFolder
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/test --quiet
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - fiit-network

volumes:
  mongo-data:
    driver: local
  mongo-config:
    driver: local

networks:
  fiit-network:
    driver: bridge